import{serializable as r,Canvas as E,CanvasGroup as P,EventList as w,Behaviour as v,getWorldPosition as S,Button as j,OrbitControls as A,getTempVector as u,Mathf as h,GameObject as H,TypeStore as g}from"./needle-engine@4.12.2.js";import{aA as G,V as _}from"./three@0.169.15.js";import"./gltf-progressive.f6515b98.js";import"./three-examples.efffc148.js";import"./three-mesh-ui.a91f26d8.js";import"./three-quarks.5328ca18.js";import"./postprocessing.170e2adf.js";var V=Object.defineProperty,I=Object.getOwnPropertyDescriptor,c=(n,e,o,t)=>{for(var s=t>1?void 0:t?I(e,o):e,i=n.length-1,a;i>=0;i--)(a=n[i])&&(s=(t?a(e,o,s):a(s))||s);return t&&s&&V(e,o,s),s};class l extends v{constructor(){super(...arguments),this.viewAngle=40,this.maxDistance=150,this.viewPoint=null,this.onActivate=new w,this.selected=!1,this.contentFadeTimestamp=-999,this.isVisible=!1,this.hotspotFadeTimestamp=-999,this.button=null,this.startForward=new _,this.onButtonClicked=()=>{this.selected?this.deselect():this.select()}}onEnable(){var e,o,t;this.startForward.copy(this.gameObject.worldForward),this.viewPoint&&(this.viewStartPoint=S(this.viewPoint).clone()),this.button=(e=this.headerCanvasGroup)==null?void 0:e.gameObject.getComponentInChildren(j),(t=(o=this.button)==null?void 0:o.onClick)==null||t.addEventListener(this.onButtonClicked),p.Instance.registerHotspot(this)}onDisable(){var e,o;(o=(e=this.button)==null?void 0:e.onClick)==null||o.removeEventListener(this.onButtonClicked),p.Instance.unregisterHotspot(this)}select(){var e,o;if(!this.selected&&(this.selected=!0,this.contentFadeTimestamp=this.context.time.time,(e=p.Instance)==null||e.onSelect(this),(o=this.onActivate)==null||o.invoke(),this.viewPoint&&!this.context.isInXR)){const t=this.context.mainCamera.getComponent(A);t&&(t.setCameraTargetPosition(this.viewStartPoint),t.setLookTargetPosition(this.gameObject))}}deselect(){this.selected&&(this.contentFadeTimestamp=this.context.time.time,this.selected=!1)}onBeforeRender(e){const o=this.context.mainCamera;if(o==null)return;if(this.context.isInXR){const i=o.worldPosition;if(this.context.xrSession.interactionMode==="screen-space"){const d=i.sub(this.forward);this.gameObject.lookAt(d)}else this.gameObject.lookAt(i)}else{const i=o.worldQuaternion;this.gameObject.worldQuaternion=i}const t=o.worldPosition.distanceTo(this.gameObject.worldPosition);let s=!0;if(t>this.maxDistance)s=!1;else{const i=this.gameObject.parent.worldScale,a=o.worldScale,d=this.gameObject.worldPosition,f=u(d);o.worldToLocal(f);const O=-1*f.z*a.x,x=h.clamp(o.fov,0,70),m=.25*Math.tan(x*h.Deg2Rad/2)*O/i.x;this.gameObject.scale.set(m,m,m);const T=this.startForward,F=this.worldPosition,y=o.worldPosition,D=u(y).sub(F).normalize();s=h.toDegrees(T.angleTo(D))<this.viewAngle}!this.selected&&s!=this.isVisible&&(this.hotspotFadeTimestamp=this.context.time.time),this.isVisible=s,this.applyFade()}applyFade(){const e=this.selected||this.isVisible?1:0,o=h.clamp01((this.context.time.time-this.hotspotFadeTimestamp)/this.hotspotFadeDuration),t=h.lerp(1-e,e,o),s=this.selected?1:0,i=h.clamp01((this.context.time.time-this.contentFadeTimestamp)/this.contentFadeDuration),a=h.lerp(1-s,s,i);this.contentCanvasGroup&&(this.contentCanvasGroup.alpha=Math.min(t,a),this.contentCanvasGroup.interactable=this.isVisible||this.selected,this.contentCanvasGroup.blocksRaycasts=this.isVisible||this.selected),this.headerCanvasGroup&&(this.headerCanvasGroup.alpha=t,this.headerCanvasGroup.interactable=this.isVisible||this.selected,this.headerCanvasGroup.blocksRaycasts=this.isVisible||this.selected)}}c([r()],l.prototype,"viewAngle",2);c([r()],l.prototype,"maxDistance",2);c([r()],l.prototype,"contentFadeDuration",2);c([r()],l.prototype,"hotspotFadeDuration",2);c([r(E)],l.prototype,"canvas",2);c([r(P)],l.prototype,"contentCanvasGroup",2);c([r(P)],l.prototype,"headerCanvasGroup",2);c([r(G)],l.prototype,"viewPoint",2);c([r(w)],l.prototype,"onActivate",2);const b=class extends v{constructor(){super(),this.forceSingleActive=!0,this.activeHotspots=[],b.Instance=this}registerHotspot(n){this.activeHotspots.indexOf(n)===-1&&this.activeHotspots.push(n)}unregisterHotspot(n){const e=this.activeHotspots.indexOf(n);e!==-1&&this.activeHotspots.splice(e,1)}onSelect(n){if(this.forceSingleActive)for(const e of this.activeHotspots)e!==n&&e&&e.deselect()}};let p=b;c([r()],p.prototype,"forceSingleActive",2);var R=Object.defineProperty,B=Object.getOwnPropertyDescriptor,M=(n,e,o,t)=>{for(var s=t>1?void 0:t?B(e,o):e,i=n.length-1,a;i>=0;i--)(a=n[i])&&(s=(t?a(e,o,s):a(s))||s);return t&&s&&R(e,o,s),s};class C extends v{constructor(){super(...arguments),this.targets=[]}start(){console.log("start"),console.log(this)}onPointerEnter(e){console.log("On Pointer Enter"),this.targets.forEach(o=>{const t=o;t&&t.onPointerEnter&&t.onPointerEnter(e)})}onPointerExit(e){console.log("On Pointer Exit"),this.targets.forEach(o=>{const t=o;t&&t.onPointerExit&&t.onPointerExit(e)})}onPointerClick(e){console.log("On Pointer Click"),this.targets.forEach(o=>{const t=o;t&&t.onPointerClick&&t.onPointerClick(e)})}onPointerUp(e){console.log("On Pointer Up"),this.targets.forEach(o=>{const t=o;t&&t.onPointerUp&&t.onPointerUp(e)})}onPointerDown(e){console.log("On Pointer Down"),this.targets.forEach(o=>{const t=o;t&&t.onPointerDown&&t.onPointerDown(e)})}}M([r(H)],C.prototype,"targets",2);g.add("HotspotBehaviour",l);g.add("HotspotManager",p);g.add("UIEventRealy",C);
